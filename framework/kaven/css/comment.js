$(function(){function f(){var a={},c=$(this).parent().parent().find("textarea");a.uid=$("#comment").attr("author-data");a.content=c.val();a.postid=$(this).parent().parent().find("textarea").attr("reply-id");a.postcid=$(this).parent().parent().find("textarea").attr("quotes-data");var b=[$(this).parent().parent().parent().find(".athead .light a").html(),$(this).parent().parent().parent().find(".athead .light a").attr("href"),$(this).parent().parent().parent().find(".reply_content").html(),$(this).parent().parent().parent().parent().find(".clistavatar img").attr("src")]; if(a.content)$(this).parent().find(".poster_w").hide();else return $(this).parent().find(".poster_w").show(),$(this).parent().find(".poster_w").html("\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a"),!1;if(4>a.content.length)return $(this).parent().find(".poster_w").show(),$(this).parent().find(".poster_w").html("\u5185\u5bb9\u4e0d\u80fd\u5c11\u4e8e4\u4e2a\u5b57"),!1;$(this).parent().find(".poster_w").hide();YYService.call("postnewComment",{complete:function(d){c.val("");$(".commentresult span").text(parseInt($(".commentresult span").text())+ 1);$(".replyinput").slideUp();$(".replythiscomment").each(function(){$(this).html("[\u56de\u590d]")});$(".replyinput").slideUp();b[2]=b[2].replace(b[2].substr(b[2].indexOf("<"),b[2].length),"");$(".commentresult").after('<div class="acommentmsg"><div class="fl clistavatar"><a href="'+$(".posteravatar a").attr("href")+'"><img width="50"height="50"src="'+$(".posteravatar img").attr("src")+'"></a></div><div class="clistcontent"style="margin-left:70px;"><div class="athead"><span class="light"><a href="'+ $(".posteravatar a").attr("href")+'">'+$(".posterinfo .light a").html()+"</a></span>"+d.date+'</div><div class="atcontent"><p class="reply_content mb10">'+a.content+'<a class="replythiscomment"href=""onclick="return false;"style="display: none;margin-left: 5px;">[\u56de\u590d]</a></p></div><div class="quotes mb10"><div class="pd10"><h4 class="light"><a href="'+b[1]+'">'+b[0]+"</a></h4>"+b[2]+'</div></div><div class="replyinput"><div class="mb10"style="border: #DAE2E5 1px solid;"><textarea quotes-data="'+ d.postid+'"reply-id="'+a.postid+'"></textarea></div><div class="submitthisreply"><div class="poster_w"></div><a href=""onclick="return false;">\u6211\u8981\u8bc4\u8bba</a></div></div></div><div class="clear"></div></div>');$(".acommentmsg").hover(function(){$(this).find(".replythiscomment").show()},function(){$(this).find(".replythiscomment").hide()});var e=!0;$(".acommentmsg:first .replythiscomment").unbind("click").click(function(){e&&(e=!1,0<$(this).html().indexOf("\u56de\u590d")?($(this).html("[\u5173\u95ed]"), $(this).parent().parent().parent().find(".replyinput").show()):($(this).html("[\u56de\u590d]"),$(this).parent().parent().parent().find(".replyinput").hide()),e=!0,window.parent.postMessage($("body").height(),"*"))});$(".submitthisreply a").unbind("click").click(function(){f.apply($(this))});window.parent.postMessage($("body").height(),"*")},error:function(a){alert("\u63d0\u4ea4\u5931\u8d25!")}},a);return!1}window.onresize=function(){$(".postinput textarea").width($(".normalcpst").width()-82-$(".postbtn").width())}; $(".postinput textarea").width($(".normalcpst").width()-82-$(".postbtn").width());$(".commentpost_login a").click(function(){"0px"!=$("#loginalert").css("top")&&($("#loginalert").show(),$(".loginmask").fadeIn(500),$("#loginalert").animate({top:0},400,"easeOutQuart"))});$(".acommentmsg").hover(function(){$(this).find(".replythiscomment").show()},function(){$(this).find(".replythiscomment").hide()});var e=!0;$(".replythiscomment").click(function(){e&&(e=!1,0<$(this).html().indexOf("\u56de\u590d")?($(this).html("[\u5173\u95ed]"), $(this).parent().parent().parent().find(".replyinput").show()):($(this).html("[\u56de\u590d]"),$(this).parent().parent().parent().find(".replyinput").hide()),e=!0,window.parent.postMessage($("body").height(),"*"))});var d={};$(".postbtn a").click(function(){d.uid=$("#comment").attr("author-data");d.content=$.trim($(".postinput textarea").val());d.postid=$(".normalcpst").attr("reply-id");if(d.content)$(".commentpost").find(".poster_w").hide();else return $(".commentpost").find(".poster_w").show(), $(".commentpost").find(".poster_w").html("\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a"),!1;if(4>d.content.length)return $(".commentpost").find(".poster_w").show(),$(".commentpost").find(".poster_w").html("\u5185\u5bb9\u4e0d\u80fd\u5c11\u4e8e4\u4e2a\u5b57"),!1;$(".commentpost").find(".poster_w").hide();YYService.call("postnewComment",{complete:function(a){$(".postinput textarea").val("");$(".commentresult span").text(parseInt($(".commentresult span").text())+1);$(".replyinput").slideUp();$(".replythiscomment").each(function(){$(this).html("[\u56de\u590d]")}); $(".commentresult").after('\x3c!--\u4e00\u6761\u8bc4\u8bba--\x3e<div class="acommentmsg"><div class="fl clistavatar"><a href="'+$(".posteravatar a").attr("href")+'"><img width="50"height="50"src="'+$(".posteravatar img").attr("src")+'"/></a></div><div class="clistcontent"style="margin-left:70px;"><div class="athead"><span class="light"><a href="'+$(".posteravatar a").attr("href")+'">'+$(".posterinfo .light a").html()+"</a></span>"+a.date+'</span></div><div class="atcontent"><p class="reply_content mb10">'+ d.content+'<a class="replythiscomment"href=""onclick="return false;">[\u56de\u590d]</a></p></div>\x3c!--\u5f15\u7528End--\x3e\x3c!--\u5f15\u7528End--\x3e\x3c!--\u56de\u590d\u8bc4\u8bba--\x3e<div class="replyinput"><div class="mb10"style="border: #DAE2E5 1px solid;"><textarea quotes-data="'+a.postid+'"reply-id="'+d.postid+'"></textarea></div><div class="submitthisreply"><div class="poster_w"></div><a href=""onclick="return false;">\u6211\u8981\u8bc4\u8bba</a></div></div>\x3c!--\u56de\u590d\u8bc4\u8bbaEnd--\x3e</div><div class="clear"></div></div>\x3c!--\u4e00\u6761\u8bc4\u8bba\u7ed3\u675f--\x3e\x3c!--\u4e00\u6761\u8bc4\u8bba--\x3e'); $(".acommentmsg").hover(function(){$(this).find(".replythiscomment").show()},function(){$(this).find(".replythiscomment").hide()});var c=!0;$(".acommentmsg:first .replythiscomment").unbind("click").click(function(){c&&(c=!1,0<$(this).html().indexOf("\u56de\u590d")?($(this).html("[\u5173\u95ed]"),$(this).parent().parent().parent().find(".replyinput").show()):($(this).html("[\u56de\u590d]"),$(this).parent().parent().parent().find(".replyinput").hide()),c=!0,window.parent.postMessage($("body").height(), "*"))});$(".submitthisreply a").click(function(){f.apply($(this))});window.parent.postMessage($("body").height(),"*")},error:function(a){alert("\u63d0\u4ea4\u5931\u8d25!")}},d);return!1});$(".submitthisreply a").click(f);$(".morecomment a").click(function(){YYService.call("getComment",{complete:function(a){if(0==a.length)return $(".morecomment").remove(),alert("\u5df2\u7ecf\u6ca1\u6709\u66f4\u591a\u8bc4\u8bba\u4e86"),!1;for(var c="",b=0;b<a.length;b++)c+='<div class="acommentmsg" data-id="'+a[b].id+ '"><div class="fl clistavatar"><a href="'+a[b].userurl+'" target="_blank"><img width="50" height="50" src="'+a[b].userimage+'" /></a></div><div class="clistcontent" style="margin-left:70px;"><div class="athead"><span class="light"><a target="_blank" href="'+a[b].userurl+'">'+a[b].nickname+"</a></span>"+a[b].postdate+'</span></div><div class="atcontent"><p class="reply_content mb10">'+a[b].content+"",$(".login").hasClass("fr")||(c+='<a style="margin-left:5px" class="replythiscomment" href="" onclick="return false;">[\u56de\u590d]</a>'), c+="</p></div>\x3c!-- \u5f15\u7528End --\x3e",a[b].comment&&(c+='<div class="quotes mb10"><div class="pd10"><h4 class="light"><a href="'+a[b].comment.userurl+'" target="_blank">'+a[b].comment.nickname+"</a></h4>"+a[b].comment.content+"</div></div>"),$(".login").hasClass("fr")||(c+='\x3c!-- \u56de\u590d\u8bc4\u8bba --\x3e<div class="replyinput"><div class="mb10" style="border: #DAE2E5 1px solid;"><textarea quotes-data="'+a[b].id+'" reply-id="'+$(".normalcpst").attr("reply-id")+'"></textarea></div><div class="submitthisreply"><div class="poster_w"></div><a href="" onclick="return false;">\u6211\u8981\u8bc4\u8bba</a></div></div>'), c+='</div><div class="clear"></div></div>';$(".comment_list").append(c);$(".acommentmsg").unbind("mouseenter mouseleave").hover(function(){$(this).find(".replythiscomment").show()},function(){$(this).find(".replythiscomment").hide()});var d=!0;$(".acommentmsg .replythiscomment").unbind("click").click(function(){d&&(d=!1,0<$(this).html().indexOf("\u56de\u590d")?($(this).html("[\u5173\u95ed]"),$(this).parent().parent().parent().find(".replyinput").slideDown(function(){d=!0})):($(this).html("[\u56de\u590d]"), $(this).parent().parent().parent().find(".replyinput").slideUp(function(){d=!0})))});$(".submitthisreply a").unbind("click").click(function(){f.apply($(this))});window.parent.postMessage($("body").height(),"*")},error:function(){alert("\u83b7\u53d6\u5931\u8d25")}},{lastid:$(".acommentmsg:last").attr("data-id"),postid:$(".normalcpst").attr("reply-id")})});window.parent.postMessage($("body").height(),"*")});